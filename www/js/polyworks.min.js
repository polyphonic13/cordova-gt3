/*! polyworksjs v0.1.0 2014-07-18 */

function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}function trace(){"undefined"==typeof console||"undefined"==typeof console.log?console={log:function(){}}:PWG.Utils.each(arguments,function(a){console.log(a)},this)}var PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){if(this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation){{this.animations[a.defaultAnimation]}this.play(a.defaultAnimation)}else b.view.frame=0;this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name;a.physics;PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY;if(this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){if(a.images){{a.images}PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)}if(a.sprites){{a.sprites}PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this)}},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)
},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0
},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;
PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c
},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];
this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))
},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}(),PWG={};PWG.Stage=function(){function a(){i.winW=document.documentElement.clientWidth,i.winH=document.documentElement.clientHeight,i.gameH=i.winH>g?g:i.winH,i.gameW=i.winH/f[1]*f[0],i.gameW>i.winW&&(i.gameW=i.winW,i.gameH=i.gameW/f[0]*f[1]),i.unit=i.gameH/f[1],i.gameX=i.winW/2-i.gameW/2,i.gameY=i.winH/2-i.gameH/2;var a=i.winW-80,c=i.winH-80,d=document.getElementById("loading"),e=document.getElementById("game_container");d&&b(d,a,c,0,0),e&&b(e,i.gameW,i.gameH,i.gameX,i.gameY)}function b(a,b,c,d,e){a.style.width=b+"px",a.style.height=c+"px",a.style.left=d+"px",a.style.top=e+"px",a.style.display="block"}function c(){var a=document.getElementById("game_container"),b=i.winW/2-i.gameW/2,c=i.winH/2-i.gameH/2;a.style.left=b+"px",a.style.top=c+"px"}var d,e,f=[16,9],g=800,h=!1,i={winW:0,winH:0,gameW:0,gameH:0,gameX:0,gameY:0,unit:0,init:function(b,h,i,j,k){"undefined"!=typeof b&&(f=b),"undefined"!=typeof h&&(g=g),d=j,e=k||window,a(),i&&(window.addEventListener("resize",function(a){c(a)}),window.addEventListener("orientationchagne",function(a){c(a)})),d&&d.call(e)},destroy:function(){h&&(window.removeEventListener("resize",function(a){c(a)}),window.removeEventListener("orientationchagne",function(a){c(a)}))}};return i}(),PWG.Storage=function(){function a(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}var b=[],c={};c.get=function(a){if(d){if(!localStorage[a])return;return JSON.parse(localStorage[a])}},c.set=function(a){if(d)for(var b in a)(a[b]instanceof Object||a[b]instanceof Array)&&(a[b]=JSON.stringify(a[b])),localStorage[b]=a[b]},c.remove=function(a){d&&localStorage.removeItem(a)},c.destroy=function(){localStorage.clear()},c.addListener=function(a){if(d){var c=!1;window.addEventListener?window.addEventListener("module",a,!1):(window.attachEvent("onmodule",a),c=!0),b.push(a)}},c.removeListener=function(a){if(d)for(var c=b.length,e=0;c>e;e++)if(b[e].listener===a){window.removeEventListener?window.removeEventListener("module",a,!1):window.detachEvent("onmodule",a),b=b.splice(e,1);break}},c.shutdown=function(){for(var a=b.length,c=0;a>c;c++)window.removeEventListener?window.removeEventListener("module",listener,!1):window.detachEvent("onmodule",listener)};var d=a();return c}(),PWG.Utils=function(){var a={};return a.each=function(a,b,c){if(Array.isArray(a))for(var d=a.length,e=0;d>e;e++)b.call(c,a[e],e,a);else for(var f in a)b.call(c,a[f],f,a)},a.clone=function(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=PWG.Utils.clone(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=PWG.Utils.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.extract=function(a,b){var c=a[b];return a!==window&&delete a[b],c},a.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},a.objLength=function(a){var b=0;for(var c in a)PWG.Utils.has(a,c)&&b++;return b},a.randomProperty=function(a){var b=Object.keys(a);return a[b[b.length*Math.random()<<0]]},a.randomKey=function(a){var b=Object.keys(a);return[b[b.length*Math.random()<<0]]},a.mixin=function(a,b){for(var c in b)b[c]&&(a[c]=b[c])},a.bind=function(a,b){return function(){return b.apply(a,arguments)}},a.inherit=function(a,b){function c(){this.constructor=a}this.mixin(a,b),c.prototype=a._super=b.prototype,a.prototype=new c},a.isInView=function(a){return a.x>0&&a.x<stageConfig.width&&a.y>0&&a.y<stageConfig.height?!0:!1},a.parseMarkup=function(a,b,c){var d=a;if(a.indexOf("~{")>-1){var e=/~\{[A-Z]*\}~/gi,f=a.match(e);if(f)for(var g in f){var h=String(f[g]),i=h.length,j=h.substring(2,i-2),k=b[j];c&&(k=encodeURIComponent(k)),k=void 0===k||null===k?h:k.toString(),d=d.replace(h,k)}else d=null}return d},a.loadScript=function(a,b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&PWG.EventCenter.trigger(b)}:c.onload=function(){PWG.EventCenter.trigger(b)},c.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(c)},a.diceRoll=function(a){var b=a||6;return Math.floor(Math.random()*b)+1},a.formatMoney=function(a,b,c,d){var b=isNaN(b=Math.abs(b))?2:b,c=void 0==c?".":c,d=void 0==d?",":d,e=0>a?"-":"",f=parseInt(a=Math.abs(+a||0).toFixed(b))+"",g=(g=f.length)>3?g%3:0;return e+(g?f.substr(0,g)+d:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d)+(b?c+Math.abs(a-f).toFixed(b).slice(2):"")},a}(),PWG.Initializer=function(){var a={hide:function(){this.view.visible=!1},show:function(){this.view.visible=!0},destroy:function(){this.view.destroy(!0)}},b={};return b.setViewAttributes=function(a,b){a&&PWG.Utils.each(a,function(a,c){b[c]=a},this)},b.addStandardMethods=function(b){PWG.Utils.each(a,function(a,c){b.prototype[c]=a},this)},b}(),PWG.GridGenerator=function(){var a={};return a.createSquare=function(b,c){return a.createRectangle(b,b,c,c)},a.createRectangle=function(a,b,c,d){for(var e,f=[],g=0;b>g;g++)for(var h=0;a>h;h++)e={start:{x:h*c,y:g*d},center:{x:(h+1)*c-c/2,y:(g+1)*d-d/2},end:{x:(h+1)*c,y:(g+1)*d}},f.push(e);return f},a}();var alphabet={UPPER:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],LOWER:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]};PWG.InputCodes={PLAY:1,LEVEL:76,NEXT:78,PAUSE:80,MENU:77,RETRY:82,RESET:99,LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,QUIT:81,START:83,CLEAR_DATA:67},PWG.Events={ZOOM_IN:"zoomIn",ZOOM_OUT:"zoomOut",QUIT:"quit"},PWG.EventCenter=function(){var a={},b={};return a.bind=function(a,c,d){var e=d||this;b[a]||(b[a]=[]),b[a].push({callback:c,context:e})},a.batchBind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.bind(a.event,a.handler,b)},b)},a.trigger=function(a){var c=b[a.type];c&&PWG.Utils.each(c,function(b){b&&b.callback&&b.callback.call(b.context,a)},this)},a.unbind=function(a,c){var d=b[a];d&&PWG.Utils.each(d,function(a,b){a&&a.callback===c&&d.splice(b,1)},this)},a.batchUnbind=function(a,b){PWG.Utils.each(a,function(a){PWG.EventCenter.unbind(a.event,a.handler,b)},b)},a.destroy=function(){PWG.Utils.each(b,function(a,c){a=[],delete b[c]},this),b=[]},a}(),PWG.PhaserScale=function(){var a={};return a.init=function(a){var b=PhaserGame.phaser.scale;a.fullScreen&&b.startFullScreen(),b.scaleMode=a.scaleMode,b.setShowAll(),this.scaleManager=b,this.refresh()},a.refresh=function(){this.scaleManager.refresh()},a}(),PWG.PhaserPositioner=function(){var a={};return a.set=function(a,b){a.centerX?b.x=PWG.Stage.gameW/2-b.width/2:a.centerToParentX?b.x=b.parent.width/2-b.width/2+b.parent.x:a.x&&(b.x=x),a.centerY?b.y=PWG.Stage.gameH/2-b.height/2:a.centerToParentY?b.y=b.parent.height/2-b.height/2+b.parent.y:a.y&&(b.y=y)},a}(),PWG.PhaserAnimation=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.name,this.animations=a.animations,PWG.Utils.each(this.animations,function(a,c){b.view.animations.add(c,a.keyFrames,a.frameRate)},this),a.defaultAnimation?(this.animations[a.defaultAnimation],this.play(a.defaultAnimation)):b.view.frame=0,this.currentAnimation=a.defaultAnimation||""}var b={};return a.prototype.play=function(a,b){if(a!==this.currentAnimation){var c=b||!1,d=this.animations[a];this.controller.view.animations.play(a,d.frameRate,d.looped,c),this.currentAnimation=a}},a.prototype.gotoFrame=function(a){this.controller.view.frame=a},a.prototype.stop=function(){this.controller.view.animations.stop(),this.currentAnimation=""},b.AnimationController=a,b.controllers={},b.addAnimations=function(c,d){var e=new a(c,d);b.controllers[e.name]=e},b.play=function(a,c,d){b.controllers.hasOwnProperty(a)&&b.controllers[a].play(c,d)},b.gotoFrame=function(a,c){b.controllers.hasOwnProperty(a)&&b.controllers[a].gotoFrame(c)},b.stop=function(a){b.controllers.hasOwnProperty(a)&&b.controllers[a].stop()},b}(),PWG.PhaserPhysics=function(){function a(a,c){this.config=a,this.controller=c,this.name=c.name,a.physics,PWG.Utils.each(a.physics,function(a,b){c.view.body[b]=a},this),b.controllers.push(this)}var b={};return b.controllers=[],a.prototype.checkCollision=function(a){b.physics.collide(this.controller.view,a)},a.prototype.checkOverlap=function(a,c,d){var e=d||this.controller.view;b.physics.overlap(this.controller.view,a,function(a,b){c.call(e,a,b)},null,this.controller.view)},a.prototype.deactivateGravity=function(){var a=this.controller.view;a.exists=!1,a.allowGravity=!1,a.body.gravity=0},a.prototype.activateGravity=function(){var a=this.controller.view;if(this.config.deferredGravity){var b=this.config.physics.gravity?this.config.physics.gravity:PhaserGame.get("gravity");a.body.gravity=b}a.allowGravity=!0,a.exists=!0},b.PhysicsController=a,b.init=function(){b.physics=PhaserGame.phaser.physics},b.checkAllCollisions=function(a){PWG.Utils.each(b.controllers,function(c){b.checkCollisions(c,a)},this)},b.checkCollisions=function(a,c){b.checkPhysics("checkCollision",a,c,null,null)},b.checkAllOverlaps=function(a,c,d){PWG.Utils.each(b.controllers,function(e){b.checkOverlaps(e,a,c,d)},this)},b.checkOverlaps=function(a){b.checkPhysics("checkOverlap",a,callback,context)},b.checkPhysics=function(a,b,c,d){d=d||b,targets instanceof Array?PWG.Utils.each(targets,function(e){b[a].call(d,e,c,d)},this):b[a].call(d,target,c,d)},b}(),PWG.PhaserTileMap=function(){function a(a){if(this.config=a,this.phaser=PhaserGame.phaser,b=this.phaser.add.tilemap("greyTilesMap"),b.addTilesetImage("factory_tileset","greyTiles"),d=b.getTile(2,3),a.layers){var e;PWG.Utils.each(a.layers,function(a){f[a.name]=b.createLayer(a.name),PWG.Initializer.setViewAttributes(a.attrs,a),a.resizeWorld&&f[a.name].resizeWorld(),e=a.name},this),this.currentLayer=a.defaultLayer||e}c=this.phaser.add.graphics(),c.lineStyle(2,16711680,1),c.drawRect(0,0,2,2),this.view=b,this.view.name=this.name=a.name,PWG.Initializer.setViewAttributes(a.attrs,this.view),PWG.EventCenter.bind(PWG.Events.ZOOM_IN,this.onZoomIn,this),PWG.EventCenter.bind(PWG.Events.ZOOM_OUT,this.onZoomOut,this)}var b,c,d,e={},f={};return a.prototype.onInputDown=function(){},a.prototype.onZoomIn=function(a){this.zoomLayers(!1,a.allLayers)},a.prototype.onZoomOut=function(a){this.zoomLayers(!0,a.allLayers)},a.prototype.zoomLayers=function(a,b){b?PWG.Utils.each(f,function(b){this.zoomLayer(b,a)},this):this.zoomLayer(f[this.currentLayer],a)},a.prototype.zoomLayer=function(a,b){var c=this.view.zoomCeil,d=this.view.zoomFloor,e=this.view.zoomFactor;b?a.scale.x>d&&(a.scale.x-=e,a.scale.y-=e):a.scale.x<c&&(a.scale.x+=e,a.scale.y+=e)},a.prototype.update=function(){if(c.x=this.phaser.input.activePointer.worldX,c.y=this.phaser.input.activePointer.worldY,this.phaser.input.mousePointer.isDown){var a=f[this.currentLayer];this.phaser.input.keyboard.isDown(Phaser.Keyboard.SHIFT)?d=b.getTile(a.getTileX(c.x),a.getTileY(c.y)):b.getTile(a.getTileX(c.x),a.getTileY(c.y))!=d&&b.putTile(d,a.getTileX(c.x),a.getTileY(c.y))}},PWG.Initializer.addStandardMethods(a),e.build=function(a){var b={};return PWG.Utils.each(a,function(a){b[a.name]=new PWG.PhaserTileMap.TileMapController(a)},this),b},e.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},e.TileMapController=a,e}(),PWG.PhaserGroup=function(){function a(a){this.name=a.name,this.config=a,this.view=PhaserGame.phaser.add.group(),PWG.Initializer.setViewAttributes(a.attrs,this.view),this.children=PWG.DisplayFactory.createPhaserViews(a.views),PWG.Utils.each(this.children,function(a){this.view.add(a.view)},this)}var b={};return a.prototype.remove=function(a){this.view.remove(a),delete this.children[a]},a.prototype.removeAll=function(){this.view.removeAll(),PWG.Utils.each(this.children,function(a){delete this.children[a]})},PWG.Initializer.addStandardMethods(a),b.Controller=a,b}(),PWG.ViewManager=function(){function a(a,c){switch(this.name=c,this.config=a,a.type){case b.SPRITE:this.view=PhaserGame.phaser.add.sprite(a.x,a.y,a.img);break;case b.TEXT:this.view=PhaserGame.phaser.add.text(a.x,a.y,a.text,a.style);break;case b.BUTTON:this.view=PhaserGame.phaser.add.button(a.x,a.y,a.img,a.callback,a.context,a.frames[0],a.frames[0],a.frames[1],a.frames[0]);break;case b.GROUP:this.view=PhaserGame.phaser.add.group()}this.set(a.attrs),a.position&&PWG.PhaserPositioner.set(a.position,this.view),a.input&&(this.inputController=new PWG.PhaserInput.InputController(a.input,this)),a.physics&&this.view.body&&(this.physicsController=new Polworks.PhaserPhysics.PhysicsController(a.physics,this)),a.animation&&PWG.PhaserAnimation.addAnimations(a.animation,this),this.view.name=this.name=a.name}var b={SPRITE:"sprite",TEXT:"text",BUTTON:"button",GROUP:"group"},c={};return a.prototype.update=function(){this.view.update&&this.view.update()},a.prototype.set=function(a){PWG.Utils.each(a,function(a,b){this.view[b]=a},this)},a.prototype.callMethod=function(a,b){this.view[a]&&this.view[a](b),"setText"===a&&this.config.position&&PWG.PhaserPositioner.set(this.config.position,this.view)},a.prototype.hide=function(){this.children&&PWG.Utils.each(this.children,function(a){a.hide()},this),this.view.visible=!1},a.prototype.show=function(){this.children&&PWG.Utils.each(this.children,function(a){a.show()},this),this.view.visible=!0},a.prototype.removeChild=function(a){this.config.type===b.GROUP&&this.children[a]&&(this.view.remove(this.children[a].view),delete this.children[a])},a.prototype.removeAll=function(){this.type===b.GROUP&&PWG.Utils.each(this.children,function(){this.view.remove(id),delete this.children[id]},this)},a.prototype.destroy=function(){this.view.destroy&&this.view.destroy()},c.ViewController=a,c.currentGroup="",c.collection={},c.init=function(a){this.collection=this.build(a)},c.build=function(a,c){var c=c||{};return PWG.Utils.each(a,function(a,d){var e=new PWG.ViewManager.ViewController(a,d);a.type===b.GROUP&&(e.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(e)),c[a.name]=e},this),c},c.initGroup=function(a){PWG.Utils.each(a.children,function(b){a.view.add(b.view),b.group=a},this)},c.showGroup=function(a){this.collection[a].show(),this.currentGroup=a},c.hideGroup=function(a){this.collection[a].hide(),this.currentGroup=""},c.switchGroup=function(a){a!==this.currentGroup&&(""!==this.currentGroup&&this.hideGroup(this.currentGroup),this.showGroup(a),this.currentGroup=a)},c.hideAllGroups=function(){PWG.Utils.each(this.collection,function(a){a.hide()},this)},c.addToGroup=function(a,b){PWG.Utils.each(a,function(a){b.add(a.view)},this)},c.removeFromGroup=function(a,b){PWG.Utils.each(a,function(a,c){b.view.remove(a.view,!0),delete b.children[c]},this)},c.removeGroupChildren=function(a){var b=c.getControllerFromPath(a);c.removeFromGroup(b.children,b)},c.addView=function(a,c,d){var e=c?c.children:this.collection,f=new PWG.ViewManager.ViewController(a,a.name);return a.type===b.GROUP&&(f.children=PWG.ViewManager.build(a.views),PWG.ViewManager.initGroup(f)),e[a.name]=f,d&&PWG.ViewManager.initGroup(c),f},c.removeView=function(a,b){var c=PWG.ViewManager.getControllerFromPath(b);c.children.hasOwnProperty(a)&&(c.children[a].view.destroy(),delete c.children[a])},c.showView=function(a){var b=this.getControllerFromPath(a);b.show()},c.hideView=function(a){var b=this.getControllerFromPath(a);b.hide()},c.callMethod=function(a,b,c){var d=this.getControllerFromPath(a);d.callMethod(b,c)},c.swapDepths=function(a){this.getControllerFromPath(a)},c.setChildFrames=function(a,b){var c=this.getControllerFromPath(a);PWG.Utils.each(c.children,function(a){a.view.frame=b},this)},c.setFrame=function(a,b){var c=this.getControllerFromPath(a);c.view.frame=b},c.getControllerFromPath=function(a){for(var b=a.split(":"),c=b.length,d=this.collection[b[0]],e=1;c>e;e++)d=d.children[b[e]];return d},c.update=function(a){PWG.Utils.each(a,function(a){a.update()},this)},c}(),PWG.ScreenManager=function(){function a(a,b){this.id=a,this.config=b}var b={};return a.prototype.create=function(){this.config.listeners&&PWG.EventCenter.batchBind(this.config.listeners,this),this.config.create&&this.config.create.apply(this,arguments)},a.prototype.render=function(){this.config.render&&this.config.render.apply(this,arguments)},a.prototype.update=function(){this.config.update&&this.config.update.apply(this,arguments)},a.prototype.shutdown=function(){this.config.shutdown&&this.config.shutdown.apply(this,arguments),this.config.listeners&&PWG.EventCenter.batchUnbind(this.config.listeners,this)},b.ScreenController=a,b.currentId="",b.screens={},b.init=function(b){PWG.Utils.each(b,function(b,c){this.screens[c]=new a(c,b)},this)},b.changeScreen=function(a){this.shutdown(),this.currentId=a,this.create()},b.preload=function(){},b.create=function(){""!==this.currentId&&this.screens[this.currentId].create()},b.update=function(){""!==this.currentId&&this.screens[this.currentId].update()},b.render=function(){""!==this.currentId&&this.screens[this.currentId].render()},b.shutdown=function(){""!==this.currentId&&this.screens[this.currentId].shutdown()},b}(),PWG.PhaserInput=function(){function a(a,b){this.config=a,this.controller=b,this.name=b.view.name;var c=b.view;c.inputEnabled=!0,PWG.Utils.each(this.config.attrs,function(a,b){c.input[b]=a},this),this.config.enableDrag&&c.input.enableDrag(this.config.enableDrag),this.config.inputDown&&c.events.onInputDown.add(this.inputDown,this),this.config.inputUp&&c.events.onInputUp.add(this.inputUp,this),this.config.onDragStop&&c.events.onDragStop.add(this.onDragStop,this),this.input=c.input}function b(a){this.name=a.name,this.config=a,this.camera=null}var c={};return a.prototype.enableDrag=function(){this.input.enableDrag()},a.prototype.enableSnap=function(a){this.input.enableSnap(a)},a.prototype.inputDown=function(){this.config.inputDown&&this.config.inputDown.call(this)},a.prototype.inputUp=function(){this.config.inputUp&&this.config.inputUp.call(this)},a.prototype.onDragStop=function(){this.config.onDragStop&&this.config.onDragStop.call(this)},a.prototype.drag=function(){},b.prototype.update=function(){this.dragCamera(PhaserGame.phaser.input.mousePointer),this.dragCamera(PhaserGame.phaser.input.pointer1)},b.prototype.dragCamera=function(a){a.timeDown&&(a.isDown&&!a.targetObject&&(this.camera&&(PhaserGame.phaser.camera.x+=this.camera.x-a.position.x,PhaserGame.phaser.camera.y+=this.camera.y-a.position.y),this.camera=a.position.clone()),a.isUp&&(this.camera=null))},c.InputController=a,c.CameraDragger=b,c.initKeyboard=function(a){c.keys={},PWG.Utils.each(a,function(a){var b,d={};b=PhaserGame.phaser.input.keyboard.addKey(a.code),a.inputDown&&(d.inputDown=a.inputDown),a.inputUp&&(d.inputUp=a.inputUp),c.keys[a.code]={key:b,input:d}},this)},c.updateKeyboard=function(){PWG.Utils.each(c.keys,function(a){a.key.isDown&&a.input.inputDown&&a.input.inputDown(),a.key.isUp&&a.input.inputUp&&a.input.inputDown()},this)},c}(),PWG.PhaserTime=function(){function a(a){this.timer=PhaserGame.phaser.time.create(!1),b[a]=this.timer}var b={};return module={},module.add=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.add(b,c,d)},module.repeat=function(a,b,c,d,e){var f=a||PhaserGame.phaser.time.events;f.repeat(b,c,d,e)},module.loop=function(a,b,c,d){var e=a||PhaserGame.phaser.time.events;e.loop(b,c,d)},module.getTimer=function(a){return b[a]},module.removeTimer=function(a){b.hasOwnProperty(a)&&(b[a].destroy(),PhaserGame.phaser.time.events.remove(b[a]),delete b[a])},a.prototype.start=function(){this.timer.start()},a.prototype.pause=function(){this.timer.pause()},a.prototype.resume=function(){this.timer.resume()},a.prototype.add=function(a,b,c){module.add(this.timer,a,b,c)},a.prototype.loop=function(a,b,c){module.loop(this.timer,a,b,c)},a.prototype.repeat=function(a,b,c){module.repeat(this.timer,a,b,c)},module.Controller=a,module}(),PWG.PhaserLoader=function(){function a(a,b){PWG.Utils.each(a,function(a,c){d.loaded[b][c]=!1},this)}var b,c,d={};return d.loaded={images:{},sprites:{},tilemaps:{}},d.init=function(d,e){b=d,c=e,a(d.images,"images"),a(d.sprites,"sprites"),a(d.tilemaps,"tilemaps")},d.load=function(a){a.images&&(a.images,PWG.Utils.each(a.images,function(a,b){this.loaded.images[b]||(c.load.image(b,a),this.loaded.images[b]=!0)},this)),a.sprites&&(a.sprites,PWG.Utils.each(a.sprites,function(a,b){this.loaded.sprites[b]||(c.load.spritesheet(b,a.url,a.width,a.height),this.loaded.sprites[b]=!0)},this))},d}(),PWG.SocialPanel=function(){function a(){b(),c()}function b(){j.parentEl=document.getElementById(j.parentId)||document.getElementsByTagName("body")[0],j.grandParentEl=j.parentEl.parentNode}function c(){j.buttons={};var a,b,c=j.buttonStyle,e=j.buttonClass||"socialButton",f=j.networks.length;PWG.Utils.each(j.networks,function(g,h){b=d(c,h,f),a={pops:j.parentEl,id:g,el:"img",attrs:{src:j.imagePath+g+".png",onclick:'PWG.SocialPanel.buttonClick("'+g+'");'},className:e,style:b},j.buttons[g]=PWG.Utils.addElement(a)},this)}function d(a,b,c){var d=PWG.Stage.winW,e=PWG.Stage.winH,f=a.position.horizontal,g=a.position.vertical,h=(a.spacer,a.offset||0),i={width:a.size.width+"px",height:a.size.height+"px"};if("center"===f){for(var j,k=0;c>k;k++)k>0&&(j+=a.spacer),j+=a.size.width;i.left=d/2-j/2+b*a.size.width+"px"}else 0>f?i.right=-f+"px":i.left=f+"px";if("center"===g){for(var l=0,k=0;c>k;k++)k>0&&(l+=a.spacer),l+=a.size.height;var m=b*a.size.height+b*a.spacer+h;i.top=e/2-l/2+m+"px"}else 0>g?i.bottom=-g+"px":i.top=g+"px";return i}function e(){var a,b=j.buttons;for(var c in b)a=b[c],a.parentNode.removeChild(a);j.parentEl&&j.parentEl.parentNode.removeChild(j.parentEl)}function f(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.bind(a.type,h,this)},this)}function g(){PWG.Utils.each(j.listeners,function(a){PWG.EventCenter.unbind(a.type,h,this)},this)}function h(a){var b;PWG.Utils.each(j.listeners,function(c){c.type===a.type&&(b=c)},this);var c=b.match;c?c.value===a.value?i(c.actions):b.nonmatch&&i(b.nonmatch.actions):i(b.actions)}function i(a){PWG.Utils.each(a,function(a){PWG.SocialPanel[a.method](a.data)},this)}var j={},k={init:function(b){j=PWG.Utils.extend(j,b),a(),f()},show:function(a){var b=a.value;j.parentEl.style.display="block",PWG.Utils.each(b,function(a){j.buttons.hasOwnProperty(a)&&(j.buttons[a].style.visibility="visible")},this)},showAll:function(){j.parentEl.style.display="block";for(var a in j.buttons)j.buttons[a].style.visibility="visible"},hideAll:function(){j.parentEl.style.display="none";for(var a in j.buttons)j.buttons[a].style.visibility="hidden"},buttonClick:function(a){var b=j.socialActions[a];if(b){var c=b[j.currentActionType];if(c){var d;d=c.params?c.url+PWG.Utils.parseMarkup(c.params,j,!0):c.url,d.indexOf("mailto")>-1&&(PWG.DeviceUtils.isIphone()||PWG.DeviceUtils.isAndroid())?window.location.href=d:window.open(d,"_blank")}}},changeData:function(a){j[a.type]=a.value},destroy:function(){g(),e()}};return k}();var PhaserGame=function(){function a(){GameConfig.loadingAnimation&&b(),GameConfig.init(d,l)}function b(){var a=document.createElement("div");a.setAttribute("id","loading_animation"),a.className="loading_animation",a.style.width=PWG.Stage.winW+"px",a.style.height=PWG.Stage.winH+"px",document.getElementsByTagName("body")[0].appendChild(a)}function c(){var a=document.getElementById("loading_animation");a.parentNode.removeChild(a)}function d(a){l.config=a,j=!0,gameLogic.init&&gameLogic.init.call(this),PWG.Utils.extend(l,gameLogic.global.methods),PWG.EventCenter.batchBind(gameLogic.global.listeners,l),PWG.ScreenManager.init(gameLogic.screens),l.init&&l.init.call(this),l.phaser=new Phaser.Game(l.stage.gameW,l.stage.gameH,Phaser.AUTO,a.gameEl,{preload:e,create:f,update:g,render:h})}function e(){PWG.PhaserLoader.init(l.config.assets,l.phaser),l.preload&&l.preload.call(this)}function f(){trace("PhaserGame/_create"),GameConfig.loadingAnimation&&c(),PWG.PhaserScale.init(l.config.stage),PWG.PhaserPhysics.init(),PWG.ViewManager.init(l.config.views),l.config.input&&l.config.input.keys&&(l.keyboard=PWG.PhaserInput.initKeyboard(l.config.input.keys)),l.create&&l.create.call(this)}function g(){l.keyboard&&PWG.PhaserInput.updateKeyboard(l.keyboard),l.update&&l.update.call(this)}function h(){l.render&&l.render.call(this)}function i(){k=!0,PWG.EventCenter.batchUnbind(gameLogic.global.listeners),PWG.ScreenManager.destroy(),l.phaser.destroy()}var j=!1,k=!1,l={};return l.camera=null,l.init=function(b,c){l.loaded={images:{},sprites:{}},l.stage=PWG.Stage,l.stage.init(b,c,!1,a,l)},l.destroy=function(){j&&(PWG.StateManager.destroy(),l.phaser.destroy(),j=!1)},l.quit=function(){k||i()},l}();
//# sourceMappingURL=polyworks.min.js.map